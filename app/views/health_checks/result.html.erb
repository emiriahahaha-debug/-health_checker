<% 
  level_color = case @level
    when "È´ò" then "text-green-600"
    when "‰∏≠" then "text-yellow-500"
    else "text-red-500"
  end 
  app_url = "https://health-checker-3bhw.onrender.com"
  share_text = "ÁßÅ„ÅÆÂÅ•Â∫∑ÊÑèË≠ò„É¨„Éô„É´„ÅØ„Äê#{@level}„Äë„Åß„Åó„ÅüÔºÅ‚ú®%0a#{@message}%0a%0a#ÂÅ•Â∫∑ÊÑèË≠ò„ÉÅ„Çß„ÉÉ„Ç´„Éº"
%>

<div class="app-bg min-h-screen py-8">
  <div class="app-container max-w-6xl mx-auto p-4">

    <h1 class="text-4xl font-bold mb-12 text-center">Ë®∫Êñ≠ÁµêÊûú</h1>

    <div class="flex flex-col lg:flex-row gap-8">

      <%# Â∑¶„Ç´„É©„É†ÔºöË®∫Êñ≠ÁµêÊûú„Å®ÊäïÁ®ø„Éï„Ç©„Éº„É† %>
      <div class="lg:w-3/5 space-y-10">

        <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
          <h2 class="text-2xl font-semibold text-gray-800 mb-4">„ÅÇ„Å™„Åü„ÅÆÂÅ•Â∫∑„É¨„Éô„É´</h2>
          <p class="text-7xl font-extrabold <%= level_color %> mb-6"><%= @level %></p>
          <p class="text-2xl text-gray-700"><%= @message %></p>
        </div>

        <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
          <h3 class="text-2xl font-bold mb-6">„Å§„Å∂„ÇÑ„Åè</h3>
          <%= form_with model: @comment, url: comments_path, local: true do |f| %>
            <div class="mb-4">
              <%= f.text_area :body, placeholder: "‰ªä„ÅÆÊ∞óÂàÜ„ÅØÔºü", rows: 3, 
                  class: "w-full p-4 border border-gray-100 rounded-2xl bg-gray-50 outline-none focus:ring-2 focus:ring-yellow-400 transition" %>
            </div>
            <%= f.submit "ÊäïÁ®ø„Åô„Çã", class: "app-button w-full py-4 shadow-lg shadow-yellow-200/50" %>
          <% end %>
        </div>
        
        <div class="text-center">
          <%= link_to "„ÇÇ„ÅÜ‰∏ÄÂ∫¶Ë®∫Êñ≠„Åô„Çã üöÄ", root_path, class: "app-button inline-block px-10" %>
        </div>
      </div>

      <%# Âè≥„Ç´„É©„É†Ôºö„Ç≥„É°„É≥„Éà‰∏ÄË¶ß„Å®SNS„Ç∑„Çß„Ç¢ %>
      <div class="lg:w-2/5">
        <div class="bg-gray-50 p-6 rounded-3xl border border-gray-200 h-fit sticky top-4">
          
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold flex items-center">
              <span>„Ç≥„É°„É≥„Éà</span>
              <span class="ml-2 text-2xl">üí¨</span>
            </h3>

            <%# X„Ç∑„Çß„Ç¢„Éú„Çø„É≥ÔºöÈªí„ÅÑ‰∏∏„Éú„Çø„É≥„Å´ÁôΩ„ÅÑX„ÅÆÊñáÂ≠ó %>
            <%= link_to "https://twitter.com/intent/tweet?text=#{share_text}", 
                target: "_blank", rel: "noopener", 
                class: "flex items-center justify-center w-10 h-10 bg-black text-white rounded-full hover:bg-gray-800 transition-all shadow-md active:scale-95" do %>
              <span style="font-family: sans-serif; font-weight: 900;" class="text-lg">X</span>
            <% end %>
          </div>

          <div class="space-y-4 max-h-[600px] overflow-y-auto pr-2">
            <% @comments.each do |comment| %>
              <div class="bg-white p-5 rounded-2xl shadow-sm border border-gray-50 group">
                <p class="text-gray-800 text-sm leading-relaxed"><%= comment.body %></p>
                <div class="flex justify-between items-center mt-3">
                  <div class="flex gap-3">
                    <%= link_to "Á∑®ÈõÜ", edit_comment_path(comment), class: "text-xs text-blue-500 hover:underline" %>
                    <%= link_to "ÂâäÈô§", comment_path(comment), 
                        data: { turbo_method: :delete, turbo_confirm: "Êú¨ÂΩì„Å´Ê∂à„Åó„Å°„ÇÉ„ÅÜÔºü ü•∫" }, 
                        class: "text-xs text-red-500 hover:underline" %>
                  </div>
                  <span class="text-[10px] text-gray-300">
                    <%= comment.created_at.strftime("%H:%M") %>
                  </span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
